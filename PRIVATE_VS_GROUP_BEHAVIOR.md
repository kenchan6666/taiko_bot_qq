# ç§èŠ vs ç¾¤èŠè¡Œä¸ºå·®å¼‚

## ğŸ¯ æ ¸å¿ƒè§„åˆ™

### ç¾¤èŠæ¶ˆæ¯
- âœ… **å¿…é¡»æåˆ° "Mika"** æ‰ä¼šå“åº”
- æ”¯æŒå˜ä½“ï¼š`Mika`ã€`ç±³å¡`ã€`mikaé…±`ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
- å¦‚æœæ²¡æœ‰æåˆ° "Mika"ï¼Œæ¶ˆæ¯ä¼šè¢«è¿‡æ»¤ï¼Œä¸å“åº”

### ç§èŠæ¶ˆæ¯
- âœ… **ç›´æ¥è¯´è¯å°±è¡Œ**ï¼Œä¸éœ€è¦æåˆ° "Mika"
- æ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šå“åº”ï¼ˆé™¤éè¢«å†…å®¹è¿‡æ»¤ï¼‰

## ğŸ“‹ å®ç°é€»è¾‘

### ä»£ç ä½ç½®
`src/steps/step1.py` ä¸­çš„ `parse_input()` å‡½æ•°

### åˆ¤æ–­é€»è¾‘

```python
# åˆ¤æ–­æ˜¯å¦ä¸ºç§èŠæ¶ˆæ¯
is_private_message = not group_id  # group_id ä¸ºç©ºå­—ç¬¦ä¸²è¡¨ç¤ºç§èŠ

if is_private_message:
    # ç§èŠï¼šè·³è¿‡ "Mika" æ£€æµ‹ï¼Œç›´æ¥å¤„ç†
    logger.info("private_message_detected", ...)
else:
    # ç¾¤èŠï¼šå¿…é¡»æ£€æµ‹ "Mika"
    match_result = MIKA_NAME_PATTERN.search(message)
    if not match_result:
        # æ²¡æœ‰æåˆ° "Mika"ï¼Œè¿‡æ»¤æ¶ˆæ¯
        return None
```

## ğŸ” æ—¥å¿—ç¤ºä¾‹

### ç§èŠæ¶ˆæ¯ï¼ˆä¸éœ€è¦ "Mika"ï¼‰

```json
{
  "event": "private_message_detected",
  "message_preview": "ä½ å¥½",
  "message_length": 2,
  "note": "Private messages don't require 'Mika' mention"
}
```

### ç¾¤èŠæ¶ˆæ¯ï¼ˆéœ€è¦ "Mika"ï¼‰

**æˆåŠŸæ£€æµ‹åˆ° "Mika"**:
```json
{
  "event": "mika_name_detected_in_group",
  "matched_text": "mika",
  "message_preview": "mikaä½ å¥½",
  "group_id": "12345678..."
}
```

**æœªæ£€æµ‹åˆ° "Mika"**:
```json
{
  "event": "mika_name_not_detected_in_group",
  "message_preview": "ä½ å¥½",
  "message_length": 2,
  "note": "Group messages require 'Mika' mention"
}
```

## âœ… ä½¿ç”¨ç¤ºä¾‹

### ç¾¤èŠåœºæ™¯

**ç”¨æˆ·**: `ä½ å¥½`  
**ç»“æœ**: âŒ ä¸å“åº”ï¼ˆæ²¡æœ‰æåˆ° "Mika"ï¼‰

**ç”¨æˆ·**: `Mika, ä½ å¥½`  
**ç»“æœ**: âœ… å“åº” "Don! ä½ å¥½ï¼ğŸ¥"

**ç”¨æˆ·**: `ç±³å¡ï¼Œæ¨èä¸€é¦–æ­Œ`  
**ç»“æœ**: âœ… å“åº”ï¼ˆ"ç±³å¡" æ˜¯æ”¯æŒçš„å˜ä½“ï¼‰

### ç§èŠåœºæ™¯

**ç”¨æˆ·**: `ä½ å¥½`  
**ç»“æœ**: âœ… å“åº” "Don! ä½ å¥½ï¼ğŸ¥"ï¼ˆä¸éœ€è¦æåˆ° "Mika"ï¼‰

**ç”¨æˆ·**: `æ¨èä¸€é¦–æ­Œ`  
**ç»“æœ**: âœ… å“åº”ï¼ˆä¸éœ€è¦æåˆ° "Mika"ï¼‰

**ç”¨æˆ·**: `Mika, ä½ å¥½`  
**ç»“æœ**: âœ… å“åº”ï¼ˆæåˆ° "Mika" ä¹Ÿå¯ä»¥ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ï¼‰

## ğŸ¨ è®¾è®¡ç†ç”±

### ä¸ºä»€ä¹ˆç¾¤èŠéœ€è¦æåˆ° "Mika"ï¼Ÿ

1. **é¿å…å¹²æ‰°**: ç¾¤èŠä¸­æ¶ˆæ¯å¾ˆå¤šï¼Œå¦‚æœæ¯æ¡æ¶ˆæ¯éƒ½å“åº”ä¼šå¤ªåµ
2. **æ˜ç¡®æ„å›¾**: æåˆ° "Mika" è¡¨æ˜ç”¨æˆ·ç¡®å®æƒ³å’Œæœºå™¨äººå¯¹è¯
3. **å‡å°‘è¯¯è§¦å‘**: é¿å…æœºå™¨äººå“åº”æ— å…³æ¶ˆæ¯

### ä¸ºä»€ä¹ˆç§èŠä¸éœ€è¦æåˆ° "Mika"ï¼Ÿ

1. **æ›´è‡ªç„¶**: ç§èŠæ˜¯ä¸€å¯¹ä¸€å¯¹è¯ï¼Œæ›´æ¥è¿‘æ­£å¸¸èŠå¤©
2. **å‡å°‘æ‘©æ“¦**: ç”¨æˆ·ä¸éœ€è¦æ¯æ¬¡éƒ½è¾“å…¥ "Mika"
3. **ç§å¯†æ€§**: ç§èŠä¸­æ‰€æœ‰æ¶ˆæ¯éƒ½æ˜¯é’ˆå¯¹æœºå™¨äººçš„

## ğŸ”§ é…ç½®

å½“å‰å®ç°æ˜¯ç¡¬ç¼–ç çš„ï¼ŒåŸºäº `group_id` æ˜¯å¦ä¸ºç©ºï¼š
- `group_id = ""` â†’ ç§èŠ
- `group_id != ""` â†’ ç¾¤èŠ

å¦‚æœéœ€è¦è°ƒæ•´è¡Œä¸ºï¼Œå¯ä»¥ä¿®æ”¹ `src/steps/step1.py` ä¸­çš„é€»è¾‘ã€‚

## ğŸ“Š æ•°æ®å­˜å‚¨

### Conversation æ¨¡å‹

- **ç§èŠ**: `group_id = ""`ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰
- **ç¾¤èŠ**: `group_id = "ç¾¤ç»„ID"`ï¼ˆå®é™…ç¾¤ç»„IDï¼‰

è¿™æ ·å¯ä»¥ï¼š
- åŒºåˆ†ç§èŠå’Œç¾¤èŠçš„å¯¹è¯å†å²
- ç»Ÿè®¡ä¸åŒç±»å‹æ¶ˆæ¯çš„å¤„ç†æƒ…å†µ

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•ç§èŠ

```bash
curl -X POST http://localhost:8000/webhook/langbot \
  -H "Content-Type: application/json" \
  -d '{
    "uuid": "test",
    "event_type": "bot.person_message",
    "data": {
      "sender": {"id": "123456", "name": "Test"},
      "message": [
        {"type": "Plain", "text": "ä½ å¥½"}
      ],
      "timestamp": 1234567890
    }
  }'
```

**é¢„æœŸ**: âœ… å“åº”ï¼ˆä¸éœ€è¦ "Mika"ï¼‰

### æµ‹è¯•ç¾¤èŠï¼ˆæ—  "Mika"ï¼‰

```bash
curl -X POST http://localhost:8000/webhook/langbot \
  -H "Content-Type: application/json" \
  -d '{
    "uuid": "test",
    "event_type": "bot.group_message",
    "data": {
      "sender": {"id": "123456", "name": "Test"},
      "group_id": "987654321",
      "message": [
        {"type": "Plain", "text": "ä½ å¥½"}
      ],
      "timestamp": 1234567890
    }
  }'
```

**é¢„æœŸ**: âŒ ä¸å“åº”ï¼ˆæ²¡æœ‰æåˆ° "Mika"ï¼‰

### æµ‹è¯•ç¾¤èŠï¼ˆæœ‰ "Mika"ï¼‰

```bash
curl -X POST http://localhost:8000/webhook/langbot \
  -H "Content-Type: application/json" \
  -d '{
    "uuid": "test",
    "event_type": "bot.group_message",
    "data": {
      "sender": {"id": "123456", "name": "Test"},
      "group_id": "987654321",
      "message": [
        {"type": "Plain", "text": "Mika, ä½ å¥½"}
      ],
      "timestamp": 1234567890
    }
  }'
```

**é¢„æœŸ**: âœ… å“åº”ï¼ˆæåˆ°äº† "Mika"ï¼‰

---

**æ€»ç»“**: 
- ğŸ—¨ï¸ **ç¾¤èŠ**: éœ€è¦æåˆ° "Mika" æ‰å“åº”
- ğŸ’¬ **ç§èŠ**: ç›´æ¥è¯´è¯å°±è¡Œï¼Œä¸éœ€è¦æåˆ° "Mika"
