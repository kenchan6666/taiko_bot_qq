# æ¨¡å‹åˆ‡æ¢å®Œæˆ - Claude 3.5 Sonnet

**æ›´æ–°æ—¥æœŸ**: 2026-01-10  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## åˆ‡æ¢å†…å®¹

### 1. é»˜è®¤æ¨¡å‹å·²åˆ‡æ¢åˆ° Claude 3.5 Sonnet âœ…

**ä¿®æ”¹æ–‡ä»¶**: `src/config.py`
- **åŸæ¥**: `openrouter_model: str = "openai/gpt-4o"`
- **ç°åœ¨**: `openrouter_model: str = "anthropic/claude-3.5-sonnet"`

**ä¿®æ”¹æ–‡ä»¶**: `src/services/llm.py`
- **åŸæ¥**: `self.model = ... else "openai/gpt-4o"`
- **ç°åœ¨**: `self.model = ... else "anthropic/claude-3.5-sonnet"`

---

### 2. Temperature å·²è°ƒæ•´ä¸ºé€‚åˆ Claude âœ…

**ä¿®æ”¹æ–‡ä»¶**: `src/steps/step4.py`
- **åŸæ¥**: `base_temperature = 0.7` (é€‚åˆ GPT-4o)
- **ç°åœ¨**: `base_temperature = 0.8` (é€‚åˆ Claude 3.5 Sonnet)

**Temperature é…ç½®**:
- **æ–°ç”¨æˆ·**: `0.8` - å¹³è¡¡ï¼Œä¸ä¼šå¤ªåˆ›æ„ä¹Ÿä¸ä¼šå¤ªæ— èŠ
- **ç†Ÿäºº**: `0.9` - ç¨å¾®åˆ›æ„ï¼Œä½†ä¿æŒè¿è´¯
- **æœ‹å‹/å¸¸å®¢**: `0.95` - æ›´åˆ›æ„å¤šæ ·ï¼ŒåƒçœŸäººæœ‹å‹èŠå¤©

**åŸå› **: Claude å¯¹ temperature æ›´æ•æ„Ÿï¼Œéœ€è¦ç¨é«˜çš„å€¼ï¼ˆ0.8-0.95ï¼‰æ‰èƒ½äº§ç”Ÿæ›´è‡ªç„¶çš„å›å¤ã€‚

---

### 3. æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜ âœ…

**ä¿®æ”¹æ–‡ä»¶**: `src/steps/step4.py`
- âœ… æ·»åŠ äº† Temperature çš„è¯¦ç»†è¯´æ˜ï¼ˆç¬¬ 405-419 è¡Œï¼‰
- âœ… è§£é‡Šäº†ä¸åŒåœºæ™¯çš„ Temperature é€‰æ‹©
- âœ… è¯´æ˜äº† Claude å¯¹ temperature æ›´æ•æ„Ÿçš„åŸå› 

**ä¿®æ”¹æ–‡ä»¶**: `src/services/llm.py`
- âœ… æ›´æ–°äº†å‡½æ•°æ–‡æ¡£ï¼Œè¯´æ˜ Temperature çš„ä½œç”¨
- âœ… è§£é‡Šäº†ä¸åŒ temperature å€¼çš„é€‚ç”¨åœºæ™¯
- âœ… è¯´æ˜äº† Claude æ¨¡å‹å¯¹ temperature çš„æ•æ„Ÿæ€§

---

## åŸæœ¬çš„æ³¨é‡Šè¯´æ˜

### Temperature å‚æ•°ï¼ˆåŸæœ¬çš„æ³¨é‡Šï¼‰

**ä½ç½®**: `src/steps/step4.py` ç¬¬ 405-419 è¡Œï¼ˆç°åœ¨å·²æ›´æ–°ï¼‰

**åŸæœ¬çš„æ³¨é‡Š**:
```python
# Adjust temperature based on relationship and randomness
# More diverse responses for friends/regular users, more stable for new users
base_temperature = 0.7
```

**ç°åœ¨çš„æ³¨é‡Š**ï¼ˆå·²æ›´æ–°ä¸ºæ›´è¯¦ç»†ï¼‰:
```python
# Adjust temperature based on relationship and randomness
# 
# What is Temperature?
# - Temperature controls the randomness/creativity of LLM responses
# - Range: 0.0 (deterministic, always same) to 2.0 (very random, creative)
# - Low (0.0-0.5): More focused, consistent, but may be repetitive
# - Medium (0.6-0.8): Balanced creativity and consistency (recommended)
# - High (0.9-1.5): More creative/diverse, but may be less coherent
# - Very High (1.5-2.0): Very random, often incoherent (not recommended)
# 
# Strategy: More diverse responses for friends/regular users, more stable for new users
# Claude models are more sensitive to temperature than GPT-4o, so we use slightly higher values
base_temperature = 0.8  # Increased from 0.7 for Claude (better human-like responses)
```

---

## Temperature æ˜¯ä»€ä¹ˆï¼Ÿ

### åŸºæœ¬æ¦‚å¿µ

**Temperatureï¼ˆæ¸©åº¦ï¼‰** æ˜¯æ§åˆ¶ LLM ç”Ÿæˆæ–‡æœ¬æ—¶**éšæœºæ€§/åˆ›é€ æ€§**çš„å‚æ•°ã€‚

### å·¥ä½œåŸç†

Temperature æ§åˆ¶æ¨¡å‹åœ¨ç”Ÿæˆæ¯ä¸ªè¯æ—¶çš„**é€‰æ‹©ç­–ç•¥**ï¼š
- **ä½ Temperature (0.0-0.5)**: 
  - æ¨¡å‹æ›´å€¾å‘äºé€‰æ‹©**æ¦‚ç‡æœ€é«˜**çš„è¯
  - ç»“æœï¼šæ›´ç¡®å®šã€ä¸€è‡´ï¼Œä½†å¯èƒ½é‡å¤
  - é€‚ç”¨ï¼šéœ€è¦å‡†ç¡®æ€§çš„ä»»åŠ¡ï¼ˆåˆ†æã€æ€»ç»“ï¼‰

- **ä¸­ Temperature (0.6-0.9)**: 
  - æ¨¡å‹åœ¨**é«˜æ¦‚ç‡è¯**ä¸­éšæœºé€‰æ‹©
  - ç»“æœï¼šå¹³è¡¡åˆ›é€ æ€§å’Œä¸€è‡´æ€§ï¼ˆæ¨èï¼‰
  - é€‚ç”¨ï¼šå¯¹è¯ã€èŠå¤©ï¼ˆClaude æ¨è 0.8-0.9ï¼‰

- **é«˜ Temperature (0.9-1.5)**: 
  - æ¨¡å‹æ›´å€¾å‘äºé€‰æ‹©**æ¦‚ç‡è¾ƒä½ä½†æœ‰è¶£**çš„è¯
  - ç»“æœï¼šæ›´éšæœºã€æœ‰åˆ›é€ æ€§ï¼Œä½†å¯èƒ½ä¸å¤ªè¿è´¯
  - é€‚ç”¨ï¼šéœ€è¦åˆ›é€ æ€§çš„å¯¹è¯ï¼ˆæœ‹å‹/å¸¸å®¢ï¼‰

- **æé«˜ Temperature (1.5-2.0)**: 
  - æ¨¡å‹å®Œå…¨éšæœºé€‰æ‹©
  - ç»“æœï¼šéå¸¸éšæœºï¼Œç»å¸¸ä¸è¿è´¯
  - é€‚ç”¨ï¼šä¸æ¨è

### å®é™…æ•ˆæœ

**Temperature = 0.5** (ä½):
```
è¾“å…¥: "Mikaï¼Œä½ å¥½ï¼"
å›å¤: (æŒ¥æ‰‹) ä½ å¥½ï¼æˆ‘æ˜¯ Mikaï¼Œä¸€ä¸ªæ‰“å¤ªé¼“çš„ç©å®¶ã€‚
```
- âœ… å‡†ç¡®ã€ä¸€è‡´
- âŒ å¯èƒ½æ˜¾å¾—"æœºå™¨äºº"
- âŒ å›å¤å¯èƒ½é‡å¤

**Temperature = 0.8** (ä¸­ï¼Œæ¨è):
```
è¾“å…¥: "Mikaï¼Œä½ å¥½ï¼"
å›å¤: (å¼€å¿ƒæŒ¥æ‰‹) å“ˆï¼ä½ å¥½å‘€ï½æˆ‘æ˜¯ Mikaï¼Œä¸€ä¸ªæ‰“å¤ªé¼“çš„ç©å®¶ï¼ä½ ä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿ
```
- âœ… è‡ªç„¶ã€å‹å¥½
- âœ… æœ‰å˜åŒ–ï¼Œä¸é‡å¤
- âœ… åƒçœŸäººè¯´è¯

**Temperature = 1.0** (é«˜):
```
è¾“å…¥: "Mikaï¼Œä½ å¥½ï¼"
å›å¤: (å…´å¥‹åœ°æŒ¥æ‰‹) å“‡ï¼ä½ å¥½ä½ å¥½ï¼(çªç„¶æƒ³èµ·ä»€ä¹ˆ) å•Šå¯¹äº†ï¼Œæˆ‘æ˜¯ Mikaï¼Œä¸€ä¸ªæ‰“å¤ªé¼“çš„ç©å®¶å‘¢ï¼ä½ ä»Šå¤©ç©å¤ªé¼“äº†å—ï¼Ÿ(å¥½å¥‡åœ°æ­ªå¤´)
```
- âœ… éå¸¸æ´»æ³¼ã€æœ‰åˆ›æ„
- âœ… å›å¤å¤šæ ·åŒ–
- âš ï¸ å¯èƒ½æœ‰ç‚¹"å¤ªæ´»æ³¼"æˆ–ä¸å¤Ÿè¿è´¯

---

## å½“å‰é…ç½®æ€»ç»“

### é»˜è®¤æ¨¡å‹
- âœ… **Claude 3.5 Sonnet** (`anthropic/claude-3.5-sonnet`)
- âœ… çœŸäººå¯¹è¯æ„Ÿæœ€å¼º
- âœ… æƒ…æ„Ÿç†è§£å¥½
- âœ… å‡†ç¡®åº¦é«˜

### Temperature é…ç½®
- âœ… **åŸºç¡€**: `0.8` (é€‚åˆ Claudeï¼Œå¹³è¡¡åˆ›é€ æ€§å’Œä¸€è‡´æ€§)
- âœ… **æ–°ç”¨æˆ·**: `0.8` (ç¨³å®šã€å‹å¥½)
- âœ… **ç†Ÿäºº**: `0.9` (ç¨å¾®åˆ›æ„)
- âœ… **æœ‹å‹/å¸¸å®¢**: `0.95` (æ›´æ´»æ³¼ã€å¤šæ ·åŒ–)

### ç‰¹æ®Šåœºæ™¯çš„ Temperature
- âœ… **å†å²åˆ†æ**: `0.5` (éœ€è¦å‡†ç¡®æ€§)
- âœ… **Self-Reflection**: `0.8` (éœ€è¦æ€è€ƒä½†ä¹Ÿè¦å®¢è§‚)
- âœ… **RLHF é€‰æ‹©**: `0.3` (éœ€è¦å®¢è§‚ã€å‡†ç¡®çš„é€‰æ‹©)

---

## å¦‚ä½•éªŒè¯åˆ‡æ¢æˆåŠŸ

### 1. æ£€æŸ¥æ¨¡å‹é…ç½®

```bash
# æŸ¥çœ‹æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ° Claude 3.5 Sonnet
grep "anthropic/claude-3.5-sonnet" logs/app.log
```

### 2. æµ‹è¯•å¯¹è¯

å‘é€æ¶ˆæ¯æµ‹è¯•ï¼š
```
Mikaï¼Œä½ å¥½ï¼
```

**æœŸæœ›æ•ˆæœ**:
- âœ… å›å¤æ›´åƒçœŸäººè¯´è¯
- âœ… è¯­æ°”æ›´è‡ªç„¶ã€å‹å¥½
- âœ… æœ‰å˜åŒ–ï¼Œä¸é‡å¤

### 3. æ£€æŸ¥ Temperature

æŸ¥çœ‹æ—¥å¿—ä¸­çš„ temperature å€¼ï¼š
```bash
grep "temperature" logs/app.log
```

**æœŸæœ›å€¼**:
- æ–°ç”¨æˆ·: `0.8`
- ç†Ÿäºº: `0.9`
- æœ‹å‹/å¸¸å®¢: `0.95`

---

## å¦‚æœéœ€è¦åˆ‡æ¢å› GPT-4o

### æ–¹æ³• 1: é€šè¿‡ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

```bash
# åœ¨ .env æ–‡ä»¶ä¸­æ·»åŠ 
OPENROUTER_MODEL=openai/gpt-4o
```

### æ–¹æ³• 2: ç›´æ¥ä¿®æ”¹ä»£ç 

ä¿®æ”¹ `src/config.py`:
```python
openrouter_model: str = "openai/gpt-4o"  # åˆ‡æ¢å› GPT-4o
```

**æ³¨æ„**: å¦‚æœåˆ‡æ¢å› GPT-4oï¼Œå»ºè®®å°† `base_temperature` æ”¹å› `0.7`ï¼š
```python
# src/steps/step4.py ç¬¬ 407 è¡Œ
base_temperature = 0.7  # GPT-4o æ¨èå€¼ï¼ˆæ¯” Claude ä½ï¼‰
```

---

## ç›¸å…³æ–‡æ¡£

å·²åˆ›å»ºçš„æ–‡æ¡£ï¼š
1. âœ… `LLM_MODEL_RECOMMENDATION.md` - è¯¦ç»†çš„æ¨¡å‹å¯¹æ¯”å’Œæ¨è
2. âœ… `HOW_TO_SWITCH_MODEL.md` - åˆ‡æ¢æŒ‡å—å’Œæµ‹è¯•æ­¥éª¤
3. âœ… `TEMPERATURE_EXPLANATION.md` - Temperature å‚æ•°è¯¦è§£
4. âœ… `MODEL_SWITCH_COMPLETED.md` - æœ¬æ–‡æ¡£ï¼Œåˆ‡æ¢å®Œæˆæ€»ç»“

---

## ä¸‹ä¸€æ­¥

1. **é‡å¯æœåŠ¡**ï¼ˆå¿…é¡»ï¼‰:
   ```bash
   # åœæ­¢å½“å‰ workerï¼ˆCtrl+Cï¼‰
   # ç„¶åé‡æ–°å¯åŠ¨
   poetry run python -m src.workers.temporal_worker
   ```

2. **æµ‹è¯•æ•ˆæœ**:
   - å‘é€å‡ æ¡æ¶ˆæ¯ï¼Œçœ‹çœ‹å›å¤æ˜¯å¦æ›´åƒçœŸäºº
   - æ£€æŸ¥æ­Œæ›²æŸ¥è¯¢æ˜¯å¦å‡†ç¡®
   - æµ‹è¯•å›¾ç‰‡åˆ†ææ˜¯å¦æ­£å¸¸

3. **è°ƒæ•´å‚æ•°**ï¼ˆå¦‚æœéœ€è¦ï¼‰:
   - å¦‚æœè§‰å¾—"ä¸å¤Ÿæ´»æ³¼"ï¼Œå¯ä»¥æé«˜ temperatureï¼ˆ0.9-1.0ï¼‰
   - å¦‚æœè§‰å¾—"å¤ªæ´»æ³¼"ï¼Œå¯ä»¥é™ä½ temperatureï¼ˆ0.7-0.8ï¼‰

4. **ç›‘æ§æˆæœ¬**:
   - Claude 3.5 Sonnet çš„æˆæœ¬ä¸ GPT-4o ç›¸è¿‘
   - å®šæœŸæ£€æŸ¥è´¦å•

---

## æ€»ç»“

âœ… **å·²å®Œæˆ**:
- âœ… é»˜è®¤æ¨¡å‹åˆ‡æ¢åˆ° Claude 3.5 Sonnet
- âœ… Temperature è°ƒæ•´ä¸ºé€‚åˆ Claude (0.8-0.95)
- âœ… æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜
- âœ… åˆ›å»ºäº†å®Œæ•´çš„æ–‡æ¡£

ğŸ¯ **é¢„æœŸæ•ˆæœ**:
- âœ… å›å¤æ›´åƒçœŸäººè¯´è¯
- âœ… è¯­æ°”æ›´è‡ªç„¶ã€å‹å¥½
- âœ… æƒ…æ„Ÿç†è§£æ›´å¥½
- âœ… å‡†ç¡®æ€§ä¿æŒ

ğŸ“š **æ–‡æ¡£**:
- âœ… `TEMPERATURE_EXPLANATION.md` - Temperature è¯¦è§£
- âœ… `LLM_MODEL_RECOMMENDATION.md` - æ¨¡å‹æ¨è
- âœ… `HOW_TO_SWITCH_MODEL.md` - åˆ‡æ¢æŒ‡å—

---

**æœ€åæ›´æ–°**: 2026-01-10  
**çŠ¶æ€**: âœ… åˆ‡æ¢å®Œæˆï¼Œç­‰å¾…æµ‹è¯•
